<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://kit.fontawesome.com/efd33a6a78.js" crossorigin="anonymous"></script>
</head>

<body>
    <div class="container">

        <div id="list-item" class="list-item">
            
        </div>

    <div class="right-container">
        <form action="#" id="main-form" >
            <div class="main-form__input">
                <label for="name">Name</label>
                <input type="text" name="name" placeholder="Enter your name" id="name" required/>
            </div>

            <div class="main-form__input">
                <label for="name">Address</label>
                <input type="text" name="address" placeholder="Enter your address" id="address" required/>
            </div>

            
            <div class="main-form__input">
                <label for="">Phone</label>
                <input type="number" placeholder="Enter your Phone" id="phone" required>
            </div>

            <div class="main-form__input">
                <label for="">Email</label>
                <input type="email" placeholder="Enter your Email" id="email" required>
            </div>

            <div class="main-form__input">
                <label for="">Age</label>
                <input type="number" min="18" max="90" placeholder="Enter your age" id="age" required>
            </div>

            <div class="main-form__input">
                <label for="">Which option is your current job?</label>
                <select id="selectOption" required>
                    <option value="" disabled selected>Select current job</option>
                    <option value="1">Student</option>
                    <option value="2">Software developer</option>
                    <option value="3">Web-fullstack developer</option>
                    <option value="4">Software engineer</option>
                </select>
            </div>

            
                <button type="submit" id="submit" class="submit-button">
                  Submit
                </button>
        </form>
    </div>

</div>

<div id="popup-section" class="edit__popup">
    
    <form action="#" id="popup__form" >
        <div class="popup__form--input">
            <label for="name">Name</label>
            <input type="text" name="name2" placeholder="Enter your name" id="name2" required/>
        </div>

        <div class="popup__form--input">
            <label for="name">Address</label>
            <input type="text" name="address2" placeholder="Enter your address" id="address2" required/>
        </div>

        
        <div class="popup__form--input">
            <label for="">Phone</label>
            <input type="number2" placeholder="Enter your Phone" id="phone2" required>
        </div>

        <div class="popup__form--input">
            <label for="">Email</label>
            <input type="email" placeholder="Enter your Email" id="email2" required>
        </div>

        <div class="popup__form--input">
            <label for="">Age</label>
            <input type="number" min="18" max="90" placeholder="Enter your age" id="age2" required>
        </div>

        <div class="popup__form--input">
            <label for="">Which option is your current job?</label>
            <select id="selectOption2" required>
                <option value="" disabled selected>Select current job</option>
                <option value="1">Student</option>
                <option value="2">Software developer</option>
                <option value="3">Web-fullstack developer</option>
                <option value="4">Software engineer</option>
            </select>
        </div>

        <button type="submit" id="submit2" class="submit-button2">
            Submit
          </button>
    </form>
  
    
</div>



<!--Javascript part*********************************************-->
<script>
    'use strict';
    var storeKey = "STUDENT_DATA";
    let listItem = document.getElementById("list-item");
    const Student = {
        

        data : [],

        
        load: function() {
            const jsonData = localStorage.getItem(storeKey);
            try {
                    this.data = JSON.parse(jsonData);
            } catch (e) {
                alert("chua co thong tin");
            }
        },

        add: function(student){
            this.data.push(student)
        },

        edit:function(index, student){
            this.data[index] = student;
        },

        delete: function(index){
            this.data.splice(index,1);
        },

        
        save: function(){
                const jsonData = JSON.stringify(this.data);
                localStorage.setItem(storeKey, jsonData);
        },


        get list(){
            return this.data;
        }

    }

      Student.load();
      renderStudents();
    

      //[{"name":"","address":"","phone":"","email":"","age":"","job":""}]
    
    document.getElementById("submit").addEventListener("click",submitClickHandle);
    function submitClickHandle() {
        
        var name = getInputValue("#name");
        var address = getInputValue("#address");
        var phone = getInputValue("#phone");
        var email = getInputValue("#email");
        var age = getInputValue("#age");
        var selected = changeSelectedValue(getInputValue("#selectOption"));
        
        Student.add({
            name: name,
            address: address,
            phone: phone,
            email: email,
            age: age,
            job: selected
            });

        Student.save();
       window.location.reload();
    }

   

    function renderStudents() {

        const Students = Student.list;

        for(let i = 0; i < Students.length; i++){

            //console.log(Students.length);
            var opiskelija = Students[i];
            var itembox = document.createElement("div");
            itembox.setAttribute("class", "item__box");
            let divItem = document.createElement("div");
            let divIcon = document.createElement("div");
            divItem.setAttribute("class", "item__box--info");
            divIcon.setAttribute("class", "item__box--icon");
            divIcon.innerHTML = '<i id="delete" class="fas fa-trash-alt" onclick="onDeleteStudent(' + i + ')"></i><i id="edit" class="fas fa-edit" onclick="onEditStudent(' + i + ')"></i>';
            divItem.innerHTML = '<p>Name: '+ opiskelija.name +'</p><p>Address : '+ opiskelija.address +'</p><p>Phone : '+ opiskelija.phone +'</p><p>Email: '+ opiskelija.email +'</p><p>Age: '+ opiskelija.age +'</p><p>Job : '+ opiskelija.job +'</p>';
            itembox.appendChild(divItem);
            itembox.appendChild(divIcon);
           // console.log(opiskelija.job);
            listItem.appendChild(itembox);
            
        }

        
    }

    function onDeleteStudent(index) {

        let CheckAnswer = confirm("Delete this student ?");
        if(CheckAnswer){
            Student.delete(index);
            Student.save();
            window.location.reload();
        }
    }

                
            

    function onEditStudent(index) {
            document.getElementById("popup-section").removeAttribute("class");
            document.getElementById("popup-section").setAttribute("class", "edit__popup--open");
            document.getElementById("submit2").addEventListener("click", submitForm);
           
            document.getElementById("name2").value = Student.data[index].name;
            document.getElementById("address2").value = Student.data[index].address;
            document.getElementById("phone2").value = Student.data[index].phone;
            document.getElementById("email2").value = Student.data[index].email;
            document.getElementById("age2").value = Student.data[index].age;

            var selectedValue = Student.data[index].job;
            console.log(selectedValue);
            switch(selectedValue){
                case "Students":
                document.getElementById("selectOption2").value = "1";
                case "Software Developer":
                document.getElementById("selectOption2").value = "2";
                case "Web -fullstack developer":
                document.getElementById("selectOption2").value = "3";
                case "Web -fullstack developer":
                document.getElementById("selectOption2").value = "4";
            }
            //******************************************DANG LAM TOI DAY
            
            function submitForm(){

                var name2 = getInputValue("#name2");
                var address2 = getInputValue("#address2");
                var phone2 = getInputValue("#phone2");
                var email2 = getInputValue("#email2");
                var age2 = getInputValue("#age2");
                var selected2 = changeSelectedValue(getInputValue("#selectOption2"));
            
                var convertStudentToString = '{"name":"'+name2+'","address":"'+address2+'","phone":"'+phone2+'","email":"'+email2+'","age":"'+age2+'","job":"'+selected2+'"}';
                var editedStudent = JSON.parse(convertStudentToString); //convert String to JSON
                Student.edit(index, editedStudent);  
                Student.save();
                window.location.reload();
            }

            
    }

    
    
    function changeSelectedValue(getValue) {
        switch(getValue){
            case "1":
            return "Students";
            break;

            case "2":
            return "Software Developer";
            break;

            case "3":
            return "Web -fullstack developer";
            break;

            case "4":
            return "Sofware engineer";
            break;

            default:
            return "Not selected";
            break;
        }
    }

    function getInputValue(selector){
        var inputValue = document.querySelector(selector);
        return inputValue.value;
    }

</script>
</body>
</html>